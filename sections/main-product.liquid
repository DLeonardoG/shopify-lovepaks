{% comment %}
  Main Product Section - Theme 2.0
  Supports App blocks (e.g. Appstle Bundles / Appstle Subscriptions).
  Add the Appstle block in Customize → Product page → Main product → Add block.
{% endcomment %}

<div class="product-page" data-product-id="{{ product.id }}">
  <div class="product-container">
    <div class="product-main">
      <div class="product-gallery">
        {% render 'product-gallery', product: product %}
      </div>

      <div class="product-info">
        <div class="product-trust-badge">
          <p>Bundle and save 15%! Unlock more savings with subscriptions</p>
        </div>

        {% if product.metafields.reviews.rating %}
          <div class="product-reviews-summary">
            <div class="star-rating" data-rating="{{ product.metafields.reviews.rating }}">
              {% assign rating = product.metafields.reviews.rating | times: 1.0 %}
              {% for i in (1..5) %}
                {% if i <= rating %}<span class="star filled">★</span>{% else %}<span class="star">★</span>{% endif %}
              {% endfor %}
            </div>
            <span class="reviews-count">({{ product.metafields.reviews.count | default: 0 }} reviews)</span>
          </div>
        {% endif %}

        <h1 class="product-title">{{ product.title }}</h1>

        {% assign variant_title = product.selected_or_first_available_variant.title %}
        {% if variant_title != product.title and variant_title != 'Default Title' %}
          <p class="variant-description" id="variant-description">{{ variant_title }}</p>
        {% endif %}

        {% if product.description != blank %}
          <div class="product-description">
            {{ product.description }}
          </div>
        {% endif %}

        {% render 'product-price', product: product %}

        <div class="stock-status" id="stock-status">
          {% if product.selected_or_first_available_variant.available %}
            <span class="in-stock">In Stock</span>
          {% else %}
            <span class="out-of-stock">Sold Out</span>
          {% endif %}
        </div>

        {% comment %} Combos / Bundles: cajitas con productos tag "combo" — debajo de stock-status {% endcomment %}
        {% assign combos_collection = section.settings.combo_bundles_collection %}
        {% if combos_collection == blank %}
          {% assign combos_collection = collections['combos'] %}
        {% endif %}
        {% if combos_collection == blank %}
          {% assign combos_collection = collections['bundles'] %}
        {% endif %}
        {% if combos_collection == blank %}
          {% assign combos_collection = collections['all'] %}
        {% endif %}
        {% comment %} No mostrar combos/bundles si el producto tiene tag mastercase {% endcomment %}
        {% unless product.tags contains 'mastercase' %}
          {% if combos_collection != blank and combos_collection.products.size > 0 %}
            {% render 'product-combos-block', collection: combos_collection %}
          {% endif %}
        {% endunless %}

        <form action="/cart/add" method="post" enctype="multipart/form-data" id="product-form">
          <input type="hidden" name="id" id="product-variant-id" value="{{ product.selected_or_first_available_variant.id }}">

          {% if product.options_with_values.size > 0 %}
            {% for option in product.options_with_values %}
              {% assign should_show_option = true %}
              {% if option.name == 'Title' or option.name == 'title' or option.name == 'TITLE' %}
                {% assign has_non_default = false %}
                {% for value in option.values %}
                  {% unless value == 'Default Title' or value == 'default title' or value == 'DEFAULT TITLE' %}
                    {% assign has_non_default = true %}
                    {% break %}
                  {% endunless %}
                {% endfor %}
                {% unless has_non_default %}{% assign should_show_option = false %}{% endunless %}
              {% endif %}

              {% if should_show_option %}
                {% if option.name == 'Flavor' or option.name == 'flavor' or option.name == 'Option1' %}
                  {% render 'variant-selector-flavor', option: option, product: product %}
                {% elsif option.name == 'Size' or option.name == 'size' or option.name == 'Option2' %}
                  {% render 'variant-selector-size', option: option, product: product %}
                {% else %}
                  {% unless option.name == 'Title' or option.name == 'title' or option.name == 'TITLE' %}
                    {% render 'variant-selector-default', option: option, product: product %}
                  {% endunless %}
                {% endif %}
              {% endif %}
            {% endfor %}
          {% endif %}

          {% comment %} Purchase options: Subscribe & Save vs One time – inyectado por app (Appstle/Seal). {% endcomment %}
          <div class="product-purchase-options" id="product-purchase-options">
            <div id="appstle-subscription-widget" class="product-app-blocks" aria-label="Subscription options"></div>
            <div class="product-app-blocks">
              {% for block in section.blocks %}
                {% if block.type == '@app' %}
                  <div class="product-app-block" {{ block.shopify_attributes }}>
                    {% render block %}
                  </div>
                {% endif %}
              {% endfor %}
            </div>
            <div class="product-subscriber-benefits" id="product-subscriber-benefits">
              {% if product.tags contains 'mastercase' %}
                <p class="product-subscriber-benefits-title">Retail and benefits:</p>
                <ul class="product-subscriber-benefits-list">
                  <li>Wholesale partner pricing</li>
                  <li>Bulk order discounts</li>
                  <li>Dedicated partner support</li>
                </ul>
              {% else %}
                <p class="product-subscriber-benefits-title">Subscriber benefits:</p>
                <ul class="product-subscriber-benefits-list">
                  <li>VIP exclusive perks and early access</li>
                  <li>Save up to 20%</li>
                  <li>Flexible delivery: Adjust, skip, cancel anytime</li>
                  <li>Free shipping on orders over $75</li>
                </ul>
              {% endif %}
            </div>
          </div>

          <div class="quantity-selector">
            <label for="quantity">Quantity:</label>
            <div class="quantity-controls">
              <button type="button" class="qty-btn qty-minus" aria-label="Decrease quantity">−</button>
              <input type="number" id="quantity" name="quantity" value="1" min="1" step="1" class="qty-input">
              <button type="button" class="qty-btn qty-plus" aria-label="Increase quantity">+</button>
            </div>
          </div>

          {% render 'add-to-cart-button', product: product %}
        </form>

        <a href="#faq" class="help-link">Is this right for me?</a>

        <div class="product-accordions">
          {% if product.metafields.custom.ingredients %}
            <details class="accordion">
              <summary>Ingredients</summary>
              <div class="accordion-content">{{ product.metafields.custom.ingredients }}</div>
            </details>
          {% endif %}
          {% if product.metafields.custom.directions %}
            <details class="accordion">
              <summary>Directions</summary>
              <div class="accordion-content">{{ product.metafields.custom.directions }}</div>
            </details>
          {% endif %}
        </div>
      </div>
    </div>

    {% comment %} Unit + Combo products: productos con tag "unit" o "combo" (excl. master-case/wholesale) {% endcomment %}
    {% assign products_collection = collections.all %}
    {% if collections.featured and collections.featured.products.size > 0 %}
      {% assign products_collection = collections.featured %}
    {% endif %}
    {% assign unit_count = 0 %}
    {% for rec_product in products_collection.products %}
      {% assign has_unit_or_combo = false %}
      {% if rec_product.tags contains 'unit' or rec_product.tags contains 'combo' %}
        {% assign has_unit_or_combo = true %}
      {% endif %}
      {% if has_unit_or_combo and rec_product.id != product.id %}
        {% unless rec_product.handle == 'master-case' or rec_product.tags contains 'wholesale' or rec_product.tags contains 'master-case' %}
          {% assign unit_count = unit_count | plus: 1 %}
        {% endunless %}
      {% endif %}
    {% endfor %}
    {% comment %} No mostrar "You may also like" si el producto tiene tag mastercase {% endcomment %}
    {% unless product.tags contains 'mastercase' %}
    {% if unit_count > 0 %}
    <section class="product-page-unit-section" aria-label="You may also like">
      <div class="product-page-unit-inner">
        <div class="product-page-unit-section-header">
          <h2 class="section-title">{{ section.settings.unit_section_title | default: 'You may also like' }}</h2>
        </div>
        <div class="product-unit-carousel-wrap">
          <button type="button" class="product-unit-carousel-btn product-unit-carousel-prev" aria-label="Previous products">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M15 18l-6-6 6-6"/></svg>
          </button>
          <button type="button" class="product-unit-carousel-btn product-unit-carousel-next" aria-label="Next products">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 18l6-6-6-6"/></svg>
          </button>
          <div class="product-unit-carousel" id="product-unit-carousel">
            <div class="product-unit-recommendations-grid" role="list">
          {% assign unit_shown = 0 %}
          {% for rec_product in products_collection.products %}
            {% assign show_in_carousel = false %}
            {% if rec_product.tags contains 'unit' or rec_product.tags contains 'combo' %}
              {% if rec_product.id != product.id %}
                {% unless rec_product.handle == 'master-case' or rec_product.tags contains 'wholesale' or rec_product.tags contains 'master-case' %}
                  {% assign show_in_carousel = true %}
                {% endunless %}
              {% endif %}
            {% endif %}
            {% if show_in_carousel %}
                {% assign unit_shown = unit_shown | plus: 1 %}
                {% assign first_variant = rec_product.selected_or_first_available_variant %}
                <div class="product-card product-unit-card">
                  <a href="{{ rec_product.url }}" class="product-card-link">
                    <div class="product-image-wrapper">
                      {% if rec_product.featured_image %}
                        <img src="{{ rec_product.featured_image | image_url: width: 800 }}" alt="{{ rec_product.featured_image.alt | default: rec_product.title | escape }}" class="product-image" loading="lazy" width="400" height="400">
                      {% else %}
                        <div class="product-image-placeholder"><span>No Image</span></div>
                      {% endif %}
                    </div>
                    <div class="product-content">
                      <h3 class="product-name">{{ rec_product.title }}</h3>
                      <span class="product-price">{{ rec_product.price | money }}</span>
                      {% if rec_product.selling_plan_groups.size > 0 %}
                        <p class="product-subscribe-note">Subscribe and Save 15%</p>
                      {% endif %}
                    </div>
                  </a>
                  {% if first_variant.available %}
                  <button type="button" class="product-unit-add-btn" data-variant-id="{{ first_variant.id }}" data-product-url="{{ rec_product.url }}" aria-label="Add {{ rec_product.title }} to cart">
                    Add to Cart
                  </button>
                {% else %}
                  <a href="{{ rec_product.url }}" class="product-unit-add-btn product-unit-add-btn--soldout" style="text-decoration:none;text-align:center;display:block;">
                    Sold Out
                  </a>
                {% endif %}
                </div>
            {% endif %}
          {% endfor %}
            </div>
          </div>
        </div>
      </div>
    </section>
    {% endif %}
    {% endunless %}

    {% comment %}
      Product subsections (FAQ, benefits, etc.) must be added in the product template
      (Theme Editor → Product page), not here. Shopify does not allow {% section %} inside a section.
    {% endcomment %}
    <div class="product-sections" id="product-sections">
      {% comment %} Optional: render FAQ and other content via snippets if you create them. {% endcomment %}
    </div>
  </div>

  <!-- FAQ Section -->
  <section class="product-faq" id="faq">
    <div class="container">
      <h2 class="section-title">Frequently Asked Questions</h2>
      <div class="faq-container">
        <div class="faq-item">
          <button class="faq-question" aria-expanded="false">
            <span>How do I feel the effects?</span>
            <svg class="faq-icon" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <polyline points="6 9 12 15 18 9"></polyline>
            </svg>
          </button>
          <div class="faq-answer">
            <p>Rose quartz has been used in many cultures for centuries for its perceived benefits. The mineral has a resonant vibrational frequency ranging from 350 Hz to 600 Hz, which may interact with a body's natural resonant energy. This product may affect individuals differently. Rose quartz's effects on the human body have not been verified or studied enough to provide an explanation to those who do not physically feel any changes. This product is designed to enhance the essence of spiritual energy and help align the chakras of individuals who may already be spiritually conscious.</p>
          </div>
        </div>

        <div class="faq-item">
          <button class="faq-question" aria-expanded="false">
            <span>Will the micro-crystals irritate my skin?</span>
            <svg class="faq-icon" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <polyline points="6 9 12 15 18 9"></polyline>
            </svg>
          </button>
          <div class="faq-answer">
            <p>Rose quartz is a natural crystal structure that affects each individual differently. If irritation, itchiness, redness, or rashes occur after use, stop using immediately and consult a dermatologist or medical professional. Rose quartz is generally recognized as safe and is used in many cosmetic products to improve skin appearance.</p>
          </div>
        </div>

        <div class="faq-item">
          <button class="faq-question" aria-expanded="false">
            <span>How does this detergent improve my wellness?</span>
            <svg class="faq-icon" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <polyline points="6 9 12 15 18 9"></polyline>
            </svg>
          </button>
          <div class="faq-answer">
            <p>Love Paks include ingredients that are generally recognized as safe and non-toxic. Many cultures have used the frequency of rose quartz for its perceived benefits over the years. Third-party tests have shown to improve the alignment of chakras in the participants, which may help to improve energy flow through the body. Participants and customers reported having improved sleep, mental clarity, and other benefits from using the product.</p>
            <p style="margin-top: 16px; font-style: italic; color: #666;">Please keep in mind, this is not a medical product, and has no intention to heal, protect, or provide any health advantages against any new or existing disease, sickness, or other medical conditions. Love Brands does not advertise, imply, or guarantee any changes in the diagnosable medical health & condition of customers for any reason.</p>
          </div>
        </div>

        <div class="faq-item">
          <button class="faq-question" aria-expanded="false">
            <span>Can this product damage my washing machine or plumbing?</span>
            <svg class="faq-icon" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <polyline points="6 9 12 15 18 9"></polyline>
            </svg>
          </button>
          <div class="faq-answer">
            <p>The micro-crystals contained within the Paks are much smaller than common silt, less than 100 microns, and other deposits contained in the unfiltered "hard water" running through many homes. Your washing machines, plumbing, and piping are designed to handle a small amount of debris. If you have any concerns about the condition of your PEX or PVC pipe, consult a plumber before using it to check for any worn-out pipes. Use Love Paks at your own risk. Love Brands and its affiliates are not responsible for any damage or harm caused by their products.</p>
          </div>
        </div>

        <div class="faq-item">
          <button class="faq-question" aria-expanded="false">
            <span>How is this product 'natural'?</span>
            <svg class="faq-icon" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <polyline points="6 9 12 15 18 9"></polyline>
            </svg>
          </button>
          <div class="faq-answer">
            <p>The ingredients used in our detergents and fragrances are plant-derived. Rose quartz is a naturally occurring mineral, and Love Brands uses true natural crystals in its products. The Pak film is a biodegradable product, unlike the standard plastic PVA film found in other laundry pods.</p>
          </div>
        </div>

        <div class="faq-item">
          <button class="faq-question" aria-expanded="false">
            <span>Is Love Paks patented?</span>
            <svg class="faq-icon" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <polyline points="6 9 12 15 18 9"></polyline>
            </svg>
          </button>
          <div class="faq-answer">
            <p>Love Brands has applied for design and utility patents for the unique heart shape design and for the process of bonding the microcrystals to the fabric during the washing process.</p>
          </div>
        </div>

        <div class="faq-item">
          <button class="faq-question" aria-expanded="false">
            <span>My Love Pak didn't dissolve all the way, what should I do?</span>
            <svg class="faq-icon" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <polyline points="6 9 12 15 18 9"></polyline>
            </svg>
          </button>
          <div class="faq-answer">
            <p>Many high-efficiency washers use less water, which affects the dissolvability of the film. If this occurs and the Love Pak is stuck to the fabric, run the Pak under warm water to allow it to fully dissolve. Rewash the garment if residual film is present.</p>
            <p style="margin-top: 16px;">Please follow proper loading procedures and place the Pak into the wash drum first, and then load the washing machine. Be sure not to overload the washing machine so the textiles can move freely and agitate the wash liquor for proper cleaning.</p>
          </div>
        </div>

        <div class="faq-item">
          <button class="faq-question" aria-expanded="false">
            <span>How can I tell the difference between a placebo effect and actual results?</span>
            <svg class="faq-icon" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <polyline points="6 9 12 15 18 9"></polyline>
            </svg>
          </button>
          <div class="faq-answer">
            <p>Studies on placebo effects are prevalent in many wellness treatments, pharmaceuticals, and personal care products. Whether it is a placebo or an actual change, your body cannot tell the difference, and you receive the same benefits. However, you can use a biofeedback device or similar to measure the energetic output of your body for confirmation.</p>
          </div>
        </div>
      </div>
    </div>
  </section>
</div>

<script type="application/json" id="product-variants-json">
{
  "product": {
    "id": {{ product.id }},
    "first_image": {{ product.featured_image | image_url: width: 2000 | json }},
    "variants": [
      {% for variant in product.variants %}
      {"id":{{ variant.id }},"title":{{ variant.title | json }},"price":{{ variant.price }},"compare_at_price":{{ variant.compare_at_price | default: 0 }},"available":{{ variant.available | json }},"option1":{{ variant.option1 | json }},"option2":{{ variant.option2 | json }},"option3":{{ variant.option3 | json }},"image":{{ variant.image | default: product.featured_image | image_url: width: 2000 | json }},"sku":{{ variant.sku | json }}}{% unless forloop.last %},{% endunless %}
      {% endfor %}
    ],
    "options": [
      {% for option in product.options_with_values %}
      {"name":{{ option.name | json }},"values":{{ option.values | json }}}{% unless forloop.last %},{% endunless %}
      {% endfor %}
    ]
  }
}
</script>

{{ 'product-page.js' | asset_url | script_tag }}

<style>
/* Descripción del producto en product-info */
.product-info .product-description {
    font-size: 15px;
    line-height: 1.65;
    color: var(--text-gray, #555);
    margin: 0 0 20px;
}
.product-info .product-description p { margin: 0 0 10px; }
.product-info .product-description p:last-child { margin-bottom: 0; }
.product-info .product-description ul,
.product-info .product-description ol { margin: 0 0 10px; padding-left: 20px; }
.product-info .product-description li { margin-bottom: 4px; }

/* Sección "You may also like" - Full width corner to corner, diseño Premium Add-ons */
.product-page-unit-section {
  padding: clamp(50px, 8vw, 80px) 0;
  background: #fff;
  margin-top: 0;
  width: 100vw;
  position: relative;
  left: 50%;
  right: 50%;
  margin-left: -50vw;
  margin-right: -50vw;
  overflow: hidden;
}
.product-page-unit-inner {
  width: 100%;
  padding-left: clamp(20px, 4vw, 60px);
  padding-right: clamp(20px, 4vw, 60px);
}
.product-page-unit-section-header {
  margin-bottom: 2rem;
}
.product-page-unit-section .section-title {
  font-size: clamp(1.5rem, 3vw, 2.25rem);
  font-weight: 800;
  margin: 0;
  font-family: 'Montserrat', sans-serif;
  color: var(--text-dark);
  text-transform: uppercase;
  letter-spacing: 0.02em;
}
/* Carrusel full width */
.product-page-unit-carousel-wrap {
  position: relative;
  margin: 0 calc(-1 * clamp(20px, 4vw, 60px));
  padding: 0 clamp(44px, 5vw, 60px);
}
.product-page-unit-carousel { overflow: hidden; }
.product-page-unit-section .product-unit-recommendations-grid {
  display: flex;
  gap: 24px;
  overflow-x: auto;
  overflow-y: hidden;
  scroll-snap-type: x mandatory;
  scroll-behavior: smooth;
  -webkit-overflow-scrolling: touch;
  scrollbar-width: none;
  -ms-overflow-style: none;
  padding: 4px 0 20px;
}
.product-page-unit-section .product-unit-recommendations-grid::-webkit-scrollbar { display: none; }
.product-page-unit-section .product-unit-card {
  flex: 0 0 min(260px, 85vw);
  min-width: 0;
  scroll-snap-align: start;
  scroll-snap-stop: always;
  display: flex;
  flex-direction: column;
  background: #fff;
  border: 1px solid rgba(0,0,0,0.08);
  box-shadow: 0 2px 12px rgba(0,0,0,0.04);
}
/* Flechas - colores marca */
.product-unit-carousel-btn {
  position: absolute;
  top: 50%;
  transform: translateY(-50%);
  z-index: 3;
  width: 44px;
  height: 44px;
  border: none;
  background: var(--primary-pink);
  color: #fff;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: background 0.2s, opacity 0.2s;
}
.product-unit-carousel-btn:hover { background: var(--burgundy); }
.product-unit-carousel-btn:disabled { opacity: 0.25; cursor: not-allowed; pointer-events: none; }
.product-unit-carousel-prev { left: 0; }
.product-unit-carousel-next { right: 0; }
/* Tarjeta de producto - diseño Premium Add-ons */
.product-page-unit-section .product-card {
  margin-top: 0;
  display: flex;
  flex-direction: column;
  flex: 1;
}
.product-page-unit-section .product-card-link {
  text-decoration: none;
  color: inherit;
  display: flex;
  flex-direction: column;
  flex: 1;
}
.product-page-unit-section .product-image-wrapper {
  position: relative;
  width: 100%;
  aspect-ratio: 1;
  overflow: hidden;
  background: #fff;
  padding: 16px;
  display: flex;
  align-items: center;
  justify-content: center;
}
.product-page-unit-section .product-image {
  width: 100%;
  height: 100%;
  object-fit: contain;
  transition: transform 0.3s ease;
}
.product-page-unit-section .product-card:hover .product-image { transform: scale(1.03); }
.product-page-unit-section .product-image-placeholder {
  width: 100%;
  height: 100%;
  display: flex;
  align-items: center;
  justify-content: center;
  background: #f5f5f5;
  color: #999;
  font-size: 14px;
}
/* Contenido - tag naranja, nombre, precio, subscribe */
.product-page-unit-section .product-content {
  padding: 16px 18px 12px;
  display: flex;
  flex-direction: column;
  gap: 8px;
  flex: 1;
  min-height: 0;
}
.product-page-unit-section .product-content .product-name {
  font-size: 1rem;
  font-weight: 700;
  margin: 0;
  line-height: 1.3;
  color: var(--text-dark);
}
.product-page-unit-section .product-content .product-price {
  font-size: 1.125rem;
  font-weight: 700;
  color: var(--primary-pink);
}
.product-page-unit-section .product-subscribe-note {
  font-size: 12px;
  color: var(--text-gray);
  margin: 0;
  font-weight: 500;
}
/* Botón Add to Cart - colores marca */
.product-unit-add-btn {
  margin: 0 18px 18px;
  padding: 14px 20px;
  font-size: 13px;
  font-weight: 700;
  letter-spacing: 0.05em;
  text-transform: uppercase;
  background: var(--primary-pink);
  color: #fff;
  border: none;
  cursor: pointer;
  transition: background 0.2s;
  font-family: inherit;
}
.product-unit-add-btn:hover { background: var(--burgundy); }
.product-unit-add-btn:disabled { opacity: 0.6; cursor: not-allowed; }
.product-unit-add-btn--soldout {
  background: #ccc !important;
  color: #666 !important;
  cursor: default;
  pointer-events: auto;
}
@media (max-width: 768px) {
  .product-page-unit-section .product-image-wrapper { padding: 12px; }
  .product-page-unit-section .product-content { padding: 14px 16px 10px; }
  .product-unit-carousel-btn { width: 40px; height: 40px; }
  .product-unit-carousel-prev { left: 4px; }
  .product-unit-carousel-next { right: 4px; }
  .product-unit-add-btn { margin: 0 16px 16px; padding: 12px 16px; }
}

/* FAQ Section */
.product-faq {
  padding: 80px 0;
  background: linear-gradient(180deg, var(--off-white) 0%, white 100%);
}

.product-faq .container {
  max-width: 1200px;
  margin: 0 auto;
  padding: 0 clamp(20px, 4vw, 60px);
}

.product-faq .section-title {
  font-family: 'Montserrat', sans-serif;
  font-size: clamp(32px, 4vw, 42px);
  font-weight: 800;
  text-align: center;
  color: var(--text-dark);
  margin-bottom: 60px;
}

.product-faq .faq-container {
  max-width: 900px;
  margin: 0 auto;
}

.product-faq .faq-item {
  background: white;
  border-radius: var(--radius-lg);
  margin-bottom: 16px;
  border: 1px solid rgba(236, 0, 140, 0.1);
  overflow: hidden;
  transition: all var(--transition-base);
}

.product-faq .faq-item:hover {
  border-color: rgba(236, 0, 140, 0.2);
  box-shadow: 0 2px 8px rgba(236, 0, 140, 0.08);
}

.product-faq .faq-question {
  width: 100%;
  padding: 24px 32px;
  background: transparent;
  border: none;
  text-align: left;
  cursor: pointer;
  display: flex;
  justify-content: space-between;
  align-items: center;
  font-size: 18px;
  font-weight: 600;
  color: var(--text-dark);
  transition: all var(--transition-fast);
}

.product-faq .faq-question:hover {
  color: var(--primary-pink);
}

.product-faq .faq-question[aria-expanded="true"] {
  color: var(--primary-pink);
}

.product-faq .faq-question span {
  flex: 1;
  padding-right: 20px;
}

.product-faq .faq-icon {
  flex-shrink: 0;
  transition: transform var(--transition-base);
  color: var(--primary-pink);
}

.product-faq .faq-question[aria-expanded="true"] .faq-icon {
  transform: rotate(180deg);
}

.product-faq .faq-answer {
  max-height: 0;
  overflow: hidden;
  transition: max-height 0.3s ease-out, padding 0.3s ease-out;
  padding: 0 32px;
}

.product-faq .faq-question[aria-expanded="true"] + .faq-answer {
  max-height: 500px;
  padding: 0 32px 24px;
}

.product-faq .faq-answer p {
  font-size: 16px;
  color: var(--text-gray);
  line-height: 1.7;
  margin: 0 0 12px;
}

.product-faq .faq-answer p:last-child {
  margin-bottom: 0;
}

@media (max-width: 768px) {
  .product-faq {
    padding: 60px 0;
  }

  .product-faq .faq-question {
    padding: 20px 24px;
    font-size: 16px;
  }

  .product-faq .faq-question span {
    padding-right: 16px;
  }

  .product-faq .faq-answer {
    padding: 0 24px;
  }

  .product-faq .faq-question[aria-expanded="true"] + .faq-answer {
    padding: 0 24px 20px;
  }
}
</style>

<script>
(function() {
  var wrap = document.querySelector('.product-unit-carousel-wrap');
  if (!wrap) return;
  var track = wrap.querySelector('.product-unit-recommendations-grid');
  var prevBtn = wrap.querySelector('.product-unit-carousel-prev');
  var nextBtn = wrap.querySelector('.product-unit-carousel-next');
  if (!track || !prevBtn || !nextBtn) return;

  function getStep() {
    var card = track.querySelector('.product-unit-card');
    return card ? card.offsetWidth + 24 : 304;
  }
  function updateButtons() {
    var maxScroll = track.scrollWidth - track.clientWidth;
    prevBtn.disabled = track.scrollLeft <= 2;
    nextBtn.disabled = track.scrollLeft >= maxScroll - 2;
  }
  prevBtn.addEventListener('click', function() {
    track.scrollBy({ left: -getStep(), behavior: 'smooth' });
  });
  nextBtn.addEventListener('click', function() {
    track.scrollBy({ left: getStep(), behavior: 'smooth' });
  });
  track.addEventListener('scroll', function() { setTimeout(updateButtons, 100); });
  window.addEventListener('resize', updateButtons);
  updateButtons();
})();

(function() {
  document.querySelectorAll('.product-unit-add-btn').forEach(function(btn) {
    btn.addEventListener('click', async function() {
      var variantId = this.getAttribute('data-variant-id');
      var productUrl = this.getAttribute('data-product-url');
      if (!variantId) return;
      this.disabled = true;
      this.textContent = 'Adding...';
      try {
        if (typeof window.addToCartShopify === 'function') {
          await window.addToCartShopify(parseInt(variantId, 10), 1);
          if (typeof window.openCartDrawer === 'function') window.openCartDrawer();
        } else {
          var r = await fetch('/cart/add.js', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ id: variantId, quantity: 1 })
          });
          var data = await r.json();
          if (data.status && document.querySelector('.cart-drawer')) {
            document.querySelector('.cart-drawer')?.classList.add('open');
          }
        }
      } catch (e) { console.warn(e); }
      this.disabled = false;
      this.textContent = 'Add to Cart';
    });
  });
})();

// FAQ Accordion Functionality
(function() {
  'use strict';
  
  function initProductFAQ() {
    const faqQuestions = document.querySelectorAll('.product-faq .faq-question');
    
    faqQuestions.forEach(question => {
      question.addEventListener('click', function() {
        const isExpanded = this.getAttribute('aria-expanded') === 'true';
        const answer = this.nextElementSibling;
        
        // Close all other FAQ items
        faqQuestions.forEach(q => {
          if (q !== this) {
            q.setAttribute('aria-expanded', 'false');
            const otherAnswer = q.nextElementSibling;
            if (otherAnswer) {
              otherAnswer.style.maxHeight = '0';
              otherAnswer.style.padding = '0 32px';
            }
          }
        });
        
        // Toggle current FAQ item
        if (isExpanded) {
          this.setAttribute('aria-expanded', 'false');
          if (answer) {
            answer.style.maxHeight = '0';
            answer.style.padding = '0 32px';
          }
        } else {
          this.setAttribute('aria-expanded', 'true');
          if (answer) {
            answer.style.maxHeight = answer.scrollHeight + 'px';
            answer.style.padding = '0 32px 24px';
          }
        }
      });
    });
  }
  
  // Initialize when DOM is ready
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initProductFAQ);
  } else {
    initProductFAQ();
  }
})();
</script>

{% schema %}
{
  "name": "Product information",
  "tag": "section",
  "class": "section-main-product",
  "blocks": [
    {
      "type": "@app"
    }
  ],
  "settings": [
    {
      "type": "collection",
      "id": "combo_bundles_collection",
      "label": "Combos / Bundles collection",
      "info": "Collection of products with tag \"combo\" (bundles). Create an automatic collection with condition: Product tag equals combo. If empty, theme tries collections \"combos\" or \"bundles\"."
    },
    {
      "type": "text",
      "id": "unit_section_title",
      "label": "You may also like - Section title",
      "default": "You may also like"
    }
  ]
}
{% endschema %}

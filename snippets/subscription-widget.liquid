{% comment %}
  Subscription Widget (Shopify Selling Plans)
  Solo se muestra si el producto tiene selling_plan_groups.
  Para suscripciones con Appstle, el widget lo inyecta la app vía App embeds.
{% endcomment %}

{% if product.selling_plan_groups.size > 0 %}
<div class="subscription-widget">
  <div class="subscription-toggle">
    <label class="subscription-label">
      <input 
        type="checkbox" 
        id="subscription-toggle"
        name="selling_plan"
        class="subscription-checkbox">
      <span class="subscription-text">
        Subscribe & Save 
        {% if product.selling_plan_groups.first.selling_plans.first.price_adjustments.first.value %}
          {{ product.selling_plan_groups.first.selling_plans.first.price_adjustments.first.value }}%
        {% else %}
          20%
        {% endif %}
      </span>
    </label>
    
    <div class="subscription-details" id="subscription-details" style="display: none;">
      <select name="selling_plan_id" id="selling-plan-select" class="selling-plan-select">
        <option value="">One-time purchase</option>
        {% for group in product.selling_plan_groups %}
          {% for plan in group.selling_plans %}
            {% assign discount_value = plan.price_adjustments.first.value | default: 0 %}
            {% assign plan_name_lower = plan.name | downcase %}
            {% if plan_name_lower contains 'quarterly' or plan_name_lower contains '3 month' or plan_name_lower contains 'every 3' or discount_value == 20 %}
              <option value="{{ plan.id }}" data-price-adjustment="{{ discount_value }}">
                Quarterly Delivery - Save {{ discount_value }}%
              </option>
            {% endif %}
          {% endfor %}
        {% endfor %}
      </select>
      
      <p class="subscription-note">
        <span class="subscription-icon">✓</span>
        Pause, skip, or cancel anytime
      </p>
    </div>
  </div>
</div>
{% endif %}

{% comment %}
  Subscription Widget
  Toggle between one-time purchase and subscription
{% endcomment %}

<div class="subscription-widget">
  <div class="subscription-toggle">
    <label class="subscription-label">
      <input 
        type="checkbox" 
        id="subscription-toggle"
        name="selling_plan"
        class="subscription-checkbox">
      <span class="subscription-text">
        Subscribe & Save 
        {% if product.selling_plan_groups.first.selling_plans.first.price_adjustments.first.value %}
          {{ product.selling_plan_groups.first.selling_plans.first.price_adjustments.first.value }}%
        {% else %}
          20%
        {% endif %}
      </span>
    </label>
    
    <div class="subscription-details" id="subscription-details" style="display: none;">
      <select name="selling_plan_id" id="selling-plan-select" class="selling-plan-select">
        <option value="">One-time purchase</option>
        {% comment %} Filter to show only quarterly plans with 20% discount {% endcomment %}
        {% for group in product.selling_plan_groups %}
          {% for plan in group.selling_plans %}
            {% assign discount_value = plan.price_adjustments.first.value | default: 0 %}
            {% assign plan_name_lower = plan.name | downcase %}
            {% comment %} Show plan if it's quarterly (every 3 months) and has 20% discount {% endcomment %}
            {% if plan_name_lower contains 'quarterly' or plan_name_lower contains '3 month' or plan_name_lower contains 'every 3' or discount_value == 20 %}
              <option value="{{ plan.id }}" data-price-adjustment="{{ discount_value }}">
                Quarterly Delivery - Save {{ discount_value }}%
              </option>
            {% endif %}
          {% endfor %}
        {% endfor %}
      </select>
      
      <p class="subscription-note">
        <span class="subscription-icon">âœ“</span>
        Pause, skip, or cancel anytime
      </p>
    </div>
  </div>
</div>


{% comment %}
  Wholesale Page — SOLO para usuarios aprobados (approved).
  Handle: wholesale-page. Asignar este template en Shopify Admin.

  VISIBILIDAD:
  - Solo si el customer tiene uno de estos tags: wholesale_approved, wholesale-partner, partner
    podrá ver la promoción y los productos con tag "mastercase".
  - Si no está aprobado: solo ve "Wholesale Access Required" y enlaces a registro/login.
  - Productos mostrados: únicamente los que tienen el tag "mastercase".

  Flujo: wholesale-register → aprobación → Continue to Wholesale → esta página.
  Scripts: shopify-cart.js + wholesale.js. Styles: shop-landing-styles.css.
{% endcomment %}

{% assign is_approved = false %}
{% if customer %}
  {% if customer.tags contains 'partner-pending-approval' %}
    {% comment %} Pendiente: no aprobado, no ve productos {% endcomment %}
  {% elsif customer.tags contains 'wholesale_approved' or customer.tags contains 'wholesale-partner' or customer.tags contains 'partner' %}
    {% assign is_approved = true %}
  {% endif %}
{% endif %}

{% comment %} Colección para productos mastercase: handle "mastercase" o "all" {% endcomment %}
{% assign mastercase_collection = collections['mastercase'] %}
{% if mastercase_collection == blank %}
  {% assign mastercase_collection = collections['all'] %}
{% endif %}

{% comment %} Solo usuarios con tag approved ven la promoción y los productos mastercase {% endcomment %}
{% if is_approved %}
  <section class="shop-hero">
    <div class="container">
      <div class="hero-content">
        <h1 class="hero-title">Wholesale — Partner Orders</h1>
        <p class="hero-subtitle">You're approved. Order mastercase products below at your wholesale price.</p>
      </div>
    </div>
  </section>

  <section class="packages-section wholesale-page-products">
    <div class="container">
      <h2 class="section-title" style="margin-bottom: 24px;">Mastercase Products</h2>
      <p style="margin-bottom: 32px; color: var(--text-gray, #555);">Only products with the <strong>mastercase</strong> tag are shown here.</p>

      <div class="packages-grid">
        {% assign shown = 0 %}
        {% if mastercase_collection != blank %}
          {% for product in mastercase_collection.products limit: 50 %}
            {% if product.tags contains 'mastercase' and shown < 12 %}
              {% assign shown = shown | plus: 1 %}
              {% assign variant = product.selected_or_first_available_variant %}
              <div class="package-card" data-package="mastercase-{{ product.id }}" data-product-id="{{ product.id }}">
                <div class="product-showcase" style="padding: 24px;">
                  {% if product.featured_image %}
                    <a href="{{ product.url }}" style="display: block;">
                      <img src="{{ product.featured_image | image_url: width: 600 }}" alt="{{ product.title | escape }}" class="product-img" loading="lazy" width="600" height="600" style="border-radius: var(--radius-md); width: 100%; aspect-ratio: 1; object-fit: cover;">
                    </a>
                  {% else %}
                    <div style="aspect-ratio: 1; background: #f5f5f5; border-radius: var(--radius-md); display: flex; align-items: center; justify-content: center; color: #999;">No image</div>
                  {% endif %}
                </div>
                <div class="package-content" style="padding: 24px;">
                  <div class="package-header">
                    <h3 class="package-name"><a href="{{ product.url }}" style="color: inherit; text-decoration: none;">{{ product.title }}</a></h3>
                    <div class="package-price">
                      <span class="price-amount">{{ variant.price | money }}</span>
                      <span class="price-label">wholesale price</span>
                    </div>
                  </div>
                  <div class="package-footer" style="margin-top: 16px;">
                    {% if variant.available %}
                      <button type="button"
                              class="btn-primary btn-large add-to-cart-btn wholesale-add-to-cart"
                              data-name="{{ product.title | escape }}"
                              data-variant-id="{{ variant.id }}"
                              data-product-url="{{ product.url }}">
                        Add to Cart
                      </button>
                    {% else %}
                      <a href="{{ product.url }}" class="btn-primary btn-large" style="display: inline-block; text-align: center; text-decoration: none;">View Product</a>
                    {% endif %}
                  </div>
                </div>
              </div>
            {% endif %}
          {% endfor %}
        {% endif %}
      </div>

      {% if shown == 0 %}
        <div style="background: #f8f6f4; border: 1px solid #e8e4e0; border-radius: 12px; padding: 40px; text-align: center;">
          <p style="margin: 0 0 12px; font-weight: 600;">No mastercase products found</p>
          <p style="margin: 0; color: var(--text-gray, #555); font-size: 14px;">Add the tag <strong>mastercase</strong> to your wholesale products in Shopify Admin (Products → [product] → Organization → Tags). You can also create a collection with handle <strong>mastercase</strong> that includes those products.</p>
        </div>
      {% endif %}
    </div>
  </section>

  <section style="padding: 24px 0 48px;">
    <div class="container" style="text-align: center;">
      <a class="btn-secondary btn-large" href="/pages/mastercase">View Wholesale Program</a>
      <a class="btn-secondary btn-large" href="{{ routes.account_url }}" style="margin-left: 12px;">My Account</a>
    </div>
  </section>

{% else %}
  <section class="wholesale-register-section" style="padding: 72px 0;">
    <div class="container" style="max-width: 900px; margin: 0 auto; padding: 0 20px;">
      <div style="background: #f8f6f4; border: 1px solid #e8e4e0; border-radius: 12px; padding: 40px 32px; text-align: center;">
        <h1 style="margin: 0 0 16px; font-size: 1.75rem;">Wholesale Access Required</h1>
        <p style="margin: 0 auto 24px; max-width: 560px; line-height: 1.5;">
          You must be logged in and approved for wholesale to see products and add to cart.
        </p>
        <div style="display: flex; gap: 12px; justify-content: center; flex-wrap: wrap;">
          <a class="btn-primary btn-large" href="/pages/wholesale-register">Apply for Wholesale</a>
          {% unless customer %}
            <a class="btn-secondary btn-large" href="{{ routes.account_login_url }}?return_to={{ request.path | url_encode }}">Log in</a>
          {% endunless %}
          <a class="btn-secondary btn-large" href="/pages/mastercase">Wholesale Program</a>
        </div>
      </div>
    </div>
  </section>
{% endif %}
